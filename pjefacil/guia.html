<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário Carta Guia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .form-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            gap: 15px;
        }
        .form-group {
            flex: 1;
            min-width: 300px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #666;
        }
        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-check {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        .form-check-input {
            margin-top: 3px;
            margin-right: 8px;
        }
        .form-check-label {
            font-size: 14px;
        }
        .radio-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .radio-option {
            display: flex;
            align-items: center;
        }
        .radio-option input {
            margin-right: 5px;
        }
        .clear-button {
            border: none;
            background: transparent;
            color: #666;
            cursor: pointer;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }
        .input-with-clear {
            position: relative;
        }
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary {
            background-color: #6200ee;
            color: white;
            border: none;
        }
        .btn-primary:hover {
            background-color: #5000c9;
        }
        .text-right {
            text-align: right;
        }
        h2 {
            margin-top: 30px;
            color: #333;
            font-size: 18px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .actions-row {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
        }
        .btn-secondary {
            background-color: #f5f5f5;
            color: #333;
            border: 1px solid #ccc;
        }
        .btn-secondary:hover {
            background-color: #e0e0e0;
        }
        .editable-section {
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 15px;
            background-color: #f9f9f9;
        }
        .editable-label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
            font-size: 14px;
        }
        .editable-content {
            border: 1px solid #ddd;
            padding: 10px;
            min-height: 80px;
            border-radius: 4px;
            background-color: #f9f9f9;
            margin-bottom: 15px;
            font-size: 14px;
            line-height: 1.5;
            width: 100%;
            box-sizing: border-box;
        }
        .editable-content:focus {
            outline: none;
            border-color: #6200ee;
            box-shadow: 0 0 5px rgba(98, 0, 238, 0.3);
            background-color: #fff;
        }
        .editable-content:empty:before {
            content: "Clique para adicionar texto...";
            color: #999;
            font-style: italic;
        }
        .editable-content[data-placeholder]:empty:before {
            content: attr(data-placeholder);
            color: #999;
            font-style: italic;
        }
        .form-actions {
            text-align: right;
            margin-top: 10px;
        }
        .form-actions button {
            margin-left: 10px;
        }
        .character-count {
            font-size: 12px;
            color: #666;
            text-align: right;
            margin-top: 5px;
        }
        .character-count.limit-exceeded {
            color: #e53935;
            font-weight: bold;
        }
        .invalid {
            border-color: #e53935 !important;
            background-color: #ffebee !important;
        }
        .editable-content.invalid {
            border-color: #e53935 !important;
            background-color: #ffebee !important;
        }
        .field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .field-title {
            font-weight: bold;
        }
        .campo-preenchido-auto {
            background-color: #e8f5e9 !important;
            border-color: #4CAF50 !important;
            transition: background-color 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="editable-section">
            <div class="form-group">
                <label class="editable-label" for="numeroInquerito">Número de Inquérito</label>
                <input type="text" id="numeroInquerito" class="form-control">
            </div>
            
            <div class="field-header">
                <label class="editable-label field-title" for="denuncia">Denúncia</label>
                <button type="button" class="btn btn-secondary btn-sm" id="inserirDenuncia">Inserir</button>
            </div>
            <div id="denuncia" class="editable-content" contenteditable="true" spellcheck="true" data-placeholder="Descreva os termos da denúncia..."></div>
            <div class="character-count" id="denunciaCount">0 caracteres</div>
            
            <div class="field-header">
                <label class="editable-label field-title" for="sentenca">Sentença</label>
                <button type="button" class="btn btn-secondary" id="resumirSentenca">Resumir</button>
                <button type="button" class="btn btn-secondary btn-sm" id="inserirSentenca">Inserir</button>
            </div>
            
            <div id="sentenca" class="editable-content" contenteditable="true" spellcheck="true" data-placeholder="Descreva os termos da sentença..."></div>
            <div class="character-count" id="sentencaCount">0 caracteres</div>
            
            <div class="field-header">
                <label class="editable-label field-title" for="acordao">Acórdão</label>
                <button type="button" class="btn btn-secondary btn-sm" id="inserirAcordao">Inserir</button>
            </div>
            <div id="acordao" class="editable-content" contenteditable="true" spellcheck="true" data-placeholder="Descreva os termos do acórdão..."></div>
            <div class="character-count" id="acordaoCount">0 caracteres</div>
            
            <div class="field-header">
                <label class="editable-label field-title" for="transitoJulgado">Trânsito em Julgado</label>
                <button type="button" class="btn btn-secondary btn-sm" id="inserirTransito">Inserir</button>
            </div>
            <div id="transitoJulgado" class="editable-content" contenteditable="true" spellcheck="true" data-placeholder="Descreva os termos do trânsito em julgado..."></div>
            <div class="character-count" id="transitoJulgadoCount">0 caracteres</div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-primary" id="concatenarCampos">Concatenar Campos</button>
            </div>
            
            <label class="editable-label" for="resumo">Resumo</label>
            <div id="resumo" class="editable-content" contenteditable="true" spellcheck="true" data-placeholder="O resumo concatenado aparecerá aqui..."></div>
            <div class="character-count" id="resumoCount">0 caracteres</div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="limparCampos">Limpar Campos</button>
                <button type="button" class="btn btn-primary" id="salvarResumo">Salvar Resumo</button>
            </div>
        </div>
        <div class="form-actions" style="margin-top: 20px; text-align: center;">
            <button type="button" id="preencherAutomatico" class="btn btn-primary" style="background-color: #4CAF50;">
                Preencher Formulário a partir do Resumo
            </button>
        </div>

        <h2>Dados da Peça</h2>
        
        <form id="guiaRecolhimentoForm">
            <!-- Tipo de Peça -->
            <div class="form-section">
                <div class="form-group">
                    <label for="tipoPeca">Tipo de peça</label>
                    <input type="text" id="tipoPeca" class="form-control" value="Guia de Recolhimento" readonly>
                </div>
                
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="guiaProvisoria" name="tipoGuia" value="provisoria">
                        <label for="guiaProvisoria">Guia de Recolhimento Provisória</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="guiaDefinitiva" name="tipoGuia" value="definitiva" checked>
                        <label for="guiaDefinitiva">Guia de Recolhimento Definitiva</label>
                    </div>
                </div>
            </div>
            
            <!-- Regime Prisional -->
            <div class="form-section">
                <div class="form-group">
                    <label for="regimePrisional">Regime Prisional</label>
                    <select id="regimePrisional" class="form-control">
                        <option value="fechado" selected>Fechado</option>
                        <option value="semiaberto">Semiaberto</option>
                        <option value="aberto">Aberto</option>
                    </select>
                </div>
            </div>
            
            <!-- Mandado de Prisão -->
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label for="mandadoPrisao">Mandado de Prisão/Internação ou Guia de Recolhimento Provisório</label>
                        <input type="text" id="mandadoPrisao" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="orgaoJudiciario">Órgão Judiciário</label>
                        <input type="text" id="orgaoJudiciario" class="form-control">
                    </div>
                </div>
                
                <div class="form-check">
                    <input type="checkbox" id="expedicaoExcepcional">
                    <label for="expedicaoExcepcional">Expedição excepcional sem mandado cumprido, por determinação judicial</label>
                </div>
            </div>
            
            <!-- Processo -->
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label for="numeroProcesso">Nº do Processo *</label>
                        <input type="text" id="numeroProcesso" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="dataExpedicao">Data de Expedição *</label>
                        <input type="text" id="dataExpedicao" class="form-control" value="15/04/2025 14:10" required>
                    </div>
                </div>
            </div>
            
            <!-- Localização -->
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label for="uf">UF</label>
                        <div class="input-with-clear">
                            <input type="text" id="uf" class="form-control" value="Pernambuco">
                            <button type="button" class="clear-button">✕</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="municipio">Município</label>
                        <div class="input-with-clear">
                            <input type="text" id="municipio" class="form-control">
                            <button type="button" class="clear-button">✕</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="localCustodia">Local da Custódia</label>
                        <div class="input-with-clear">
                            <input type="text" id="localCustodia" class="form-control">
                            <button type="button" class="clear-button">✕</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dados do Processo Criminal -->
            <h2>Dados do Processo Criminal</h2>
            
            <div class="form-section">
                <div class="form-group">
                    <label for="tipoProcessoCriminal">Tipo de Processo Criminal*</label>
                    <select id="tipoProcessoCriminal" class="form-control" required>
                        <option value="" selected>Selecione</option>
                        <option value="283">283 - Ação Penal - Procedimento Ordinário</option>
                        <option value="284">284 - Ação Penal - Procedimento Sumário</option>
                        <option value="285">285 - Ação Penal - Procedimento Especial</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="revisaoCriminal">Revisão Criminal? *</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="revisaoSim" name="revisaoCriminal" value="sim">
                            <label for="revisaoSim">Sim</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="revisaoNao" name="revisaoCriminal" value="nao" checked>
                            <label for="revisaoNao">Não</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Datas do Processo -->
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label for="dataInfracao">Data da Infração *</label>
                        <div class="input-with-clear">
                            <input type="text" id="dataInfracao" class="form-control" placeholder="dd/mm/aaaa" required>
                            <button type="button" class="clear-button">📅</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="dataRecebimentoDenuncia">Data de Recebimento da Denúncia/Queixa *</label>
                        <div class="input-with-clear">
                            <input type="text" id="dataRecebimentoDenuncia" class="form-control" placeholder="dd/mm/aaaa" required>
                            <button type="button" class="clear-button">📅</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="dataPublicacaoPronuncia">Data do Publicação da Pronúncia</label>
                        <div class="input-with-clear">
                            <input type="text" id="dataPublicacaoPronuncia" class="form-control" placeholder="dd/mm/aaaa">
                            <button type="button" class="clear-button">📅</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="dataPublicacaoSentenca">Data de Publicação da Sentença *</label>
                        <div class="input-with-clear">
                            <input type="text" id="dataPublicacaoSentenca" class="form-control" placeholder="dd/mm/aaaa" required>
                            <button type="button" class="clear-button">📅</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="dataPublicacaoAcordao">Data de Publicação do Acórdão</label>
                        <div class="input-with-clear">
                            <input type="text" id="dataPublicacaoAcordao" class="form-control" placeholder="dd/mm/aaaa">
                            <button type="button" class="clear-button">📅</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="dataTransitoDefesa">Data do Trânsito em Julgado para Defesa *</label>
                        <div class="input-with-clear">
                            <input type="text" id="dataTransitoDefesa" class="form-control" placeholder="dd/mm/aaaa" required>
                            <button type="button" class="clear-button">📅</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="dataTransitoAcusacao">Data de Trânsito em Julgado da Acusação *</label>
                        <div class="input-with-clear">
                            <input type="text" id="dataTransitoAcusacao" class="form-control" placeholder="dd/mm/aaaa" required>
                            <button type="button" class="clear-button">📅</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="dataTransitoAssistente">Data de Trânsito em Julgado da Assistente de Acusação</label>
                        <div class="input-with-clear">
                            <input type="text" id="dataTransitoAssistente" class="form-control" placeholder="dd/mm/aaaa">
                            <button type="button" class="clear-button">📅</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="dataTransitoReu">Data de Trânsito em Julgado do réu *</label>
                        <div class="input-with-clear">
                            <input type="text" id="dataTransitoReu" class="form-control" placeholder="dd/mm/aaaa" required>
                            <button type="button" class="clear-button">📅</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Cadastro da Sentença -->
            <h2>Cadastro da Sentença</h2>
            
            <div class="form-section">
                <div class="form-group">
                    <label for="tipoPena">Tipo da Pena *</label>
                    <select id="tipoPena" class="form-control" required>
                        <option value="apelacao" selected>Apelação Criminal</option>
                        <option value="recurso">Recurso Ordinário Criminal</option>
                        <option value="outra">Outra</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="numeroRecurso">Nº do Recurso*</label>
                    <input type="text" id="numeroRecurso" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="recorrentesRecurso">Recorrentes do Recurso *</label>
                    <select id="recorrentesRecurso" class="form-control" required>
                        <option value="reu" selected>O Réu</option>
                        <option value="mp">Ministério Público</option>
                        <option value="outro">Outro</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="dataDecisaoRecurso">Data de Decisão do Recurso *</label>
                    <div class="input-with-clear">
                        <input type="text" id="dataDecisaoRecurso" class="form-control" placeholder="dd/mm/aaaa" required>
                        <button type="button" class="clear-button">📅</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="orgaoJudiciarioRecurso">Órgão Judiciário *</label>
                    <input type="text" id="orgaoJudiciarioRecurso" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="camaraJulgadora">Câmara Julgadora do Recurso *</label>
                    <input type="text" id="camaraJulgadora" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="dataTransitoRecurso">Data de Trânsito em Julgado do Recurso *</label>
                    <div class="input-with-clear">
                        <input type="text" id="dataTransitoRecurso" class="form-control" placeholder="dd/mm/aaaa" required>
                        <button type="button" class="clear-button">📅</button>
                    </div>
                </div>
            </div>
            
            <!-- Tipificação Penal -->
            <h2>Tipificação Penal</h2>
            
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label for="lei">Lei*</label>
                        <select id="lei" class="form-control" required>
                            <option value="" selected>Selecione</option>
                            <option value="2848">Lei 2848 - Código Penal</option>
                            <option value="11343">Lei 11343 - Lei de Drogas</option>
                            <option value="8069">Lei 8069 - Estatuto da Criança e do Adolescente</option>
                            <option value="10826">Lei 10826 - Estatuto do Desarmamento</option>
                            <option value="9605">Lei 9605 - Lei de Crimes Ambientais</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="artigo">Artigo *</label>
                        <div class="input-with-clear">
                            <input type="text" id="artigo" class="form-control" required>
                            <button type="button" class="clear-button">✕</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="complemento">Complemento</label>
                    <input type="text" id="complemento" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="dataDelito">Data do Delito</label>
                    <div class="input-with-clear">
                        <input type="text" id="dataDelito" class="form-control" placeholder="dd/mm/aaaa">
                        <button type="button" class="clear-button">📅</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="checkbox-group">
                        <div class="form-check">
                            <input type="checkbox" id="crimeTentado" class="form-check-input">
                            <label for="crimeTentado" class="form-check-label">Crime Tentado</label>
                        </div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="violenciaDomestica" class="form-check-input">
                            <label for="violenciaDomestica" class="form-check-label">Violência Doméstica</label>
                        </div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="resultadoMorte" class="form-check-input">
                            <label for="resultadoMorte" class="form-check-label">Resultado da Morte</label>
                        </div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="violenciaGraveAmeaca" class="form-check-input">
                            <label for="violenciaGraveAmeaca" class="form-check-label">Com Violência ou Grave Ameaça</label>
                        </div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="reincidenteComum" class="form-check-input">
                            <label for="reincidenteComum" class="form-check-label">Reincidente Comum</label>
                        </div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="reincidenteEspecifico" class="form-check-input">
                            <label for="reincidenteEspecifico" class="form-check-label">Reincidente Específico</label>
                        </div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="comandoOrganizacao" class="form-check-input">
                            <label for="comandoOrganizacao" class="form-check-label">Condenado por exercer o comando organização criminosa para cometimento de crime hediondo</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="fracaoProgressao">Fração Progressão Regime</label>
                    <select id="fracaoProgressao" class="form-control">
                        <option value="">Selecione</option>
                        <option value="1/6">1/6</option>
                        <option value="2/5">2/5</option>
                        <option value="3/5">3/5</option>
                        <option value="1/2">1/2</option>
                        <option value="1/3">1/3</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="fracaoLivramento">Fração Livramento Condicional</label>
                    <select id="fracaoLivramento" class="form-control">
                        <option value="">Selecione</option>
                        <option value="1/3">1/3</option>
                        <option value="1/2">1/2</option>
                        <option value="2/3">2/3</option>
                        <option value="3/4">3/4</option>
                    </select>
                </div>
                
               <div class="form-group">
                    <label for="tempoPena">Tempo de Pena</label>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1; margin-right: 10px;">
                            <label for="anos">Anos</label>
                            <input type="number" id="anos" class="form-control" min="0">
                        </div>
                        <div class="form-group" style="flex: 1; margin-right: 10px;">
                            <label for="meses">Meses</label>
                            <input type="number" id="meses" class="form-control" min="0" max="11">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="dias">Dias</label>
                            <input type="number" id="dias" class="form-control" min="0" max="30">
                        </div>
                    </div>
                </div>
                
                <div class="form-group text-right">
                    <button type="button" class="btn btn-primary" id="adicionarParagrafo">+ Adicionar Parágrafo</button>
                </div>
            </div>
            
            <!-- Botões de ação -->
            <div class="actions-row">
                <button type="button" class="btn btn-secondary" id="cancelarForm">Cancelar</button>
                <button type="button" class="btn btn-secondary" id="salvarRascunho">Salvar como Rascunho</button>
                <button type="submit" class="btn btn-primary" id="salvarFormulario">Salvar</button>
            </div>
        </form>
    </div>

    <!-- Scripts -->
    <script>

document.addEventListener('DOMContentLoaded', function() {
    /**
     * Função para contar caracteres brutos sem qualquer processamento
     * Para garantir a contagem mais alta e precisa possível
     * 
     * @param {HTMLElement|string} elemento - Elemento HTML ou texto para contar caracteres
     * @param {string} contadorId - ID do elemento que exibirá a contagem
     * @param {number} limiteAviso - Limite para exibir aviso de excesso de caracteres
     * @returns {number} - Número de caracteres
     */
    function contarCaracteres(elemento, contadorId, limiteAviso = 5000) {
        // Obter texto bruto sem processamento adicional
        let texto;
        
        if (typeof elemento === 'string') {
            texto = elemento;
        } else {
            // Para elementos HTML, capturar o HTML interno completo
            const htmlCompleto = elemento.innerHTML;
            
            // Processar o HTML para obter texto puro preservando quebras de linha
            const temp = document.createElement('div');
            temp.innerHTML = htmlCompleto;
            
            // Usar textContent que preserva espaços em branco e quebras
            texto = temp.textContent || "";
            
            // Verificação de backup se textContent estiver vazio
            if (!texto.trim() && elemento.innerText) {
                texto = elemento.innerText;
            }
        }
        
        // Contar caracteres brutos sem qualquer processamento
        const numCaracteres = texto.length;
        
        // Atualizar o contador
        const contador = document.getElementById(contadorId);
        if (contador) {
            contador.textContent = numCaracteres + ' caracteres (brutos)';
            
            if (numCaracteres > limiteAviso) {
                contador.classList.add('limit-exceeded');
            } else {
                contador.classList.remove('limit-exceeded');
            }
            
            contador.title = `Contagem total: ${numCaracteres} caracteres`;
        }
        
        return numCaracteres;
    }

    // Função auxiliar para inicializar a contagem em múltiplos campos
    function inicializarContagemCaracteres() {
        const camposEditaveis = [
            { campo: 'denuncia', contador: 'denunciaCount', limite: 10000 },
            { campo: 'sentenca', contador: 'sentencaCount', limite: 15000 },
            { campo: 'acordao', contador: 'acordaoCount', limite: 15000 },
            { campo: 'transitoJulgado', contador: 'transitoJulgadoCount', limite: 5000 },
            { campo: 'resumo', contador: 'resumoCount', limite: 20000 }
        ];
        
        camposEditaveis.forEach(({ campo, contador, limite }) => {
            const elemento = document.getElementById(campo);
            if (elemento) {
                const atualizarContador = () => contarCaracteres(elemento, contador, limite);
                
                // Contar caracteres iniciais
                atualizarContador();
                
                // Atualizar contador ao digitar
                elemento.addEventListener('input', atualizarContador);
                
                // Atualizar contador após colar (com pequeno atraso)
                elemento.addEventListener('paste', () => setTimeout(atualizarContador, 10));
                
                // Atualizar após corte de texto
                elemento.addEventListener('cut', () => setTimeout(atualizarContador, 10));
                
                // Monitorar mudanças via script
                const observer = new MutationObserver(atualizarContador);
                observer.observe(elemento, { 
                    childList: true, 
                    characterData: true, 
                    subtree: true 
                });
            }
        });

        return camposEditaveis;
    }



        // Define camposEditaveis no escopo principal e inicializa contagem
        const camposEditaveis = inicializarContagemCaracteres();
    
        // Teste para verificar a diferença de contagem em sistemas diferentes
        function testarContagem() {
            const textoTeste = `Lorem ipsum dolor sit amet, consectetur adipiscing elit.
            Praesent vel rhoncus nisl. Nunc vel magna nec ex lobortis laoreet.
            Aenean posuere dui eget purus malesuada, non tempus tellus interdum.
            Duis varius mauris in lectus scelerisque, ut pharetra lectus venenatis.`;
            
            console.log('Teste de contagem:', {
                length: textoTeste.length,
                bytes: new Blob([textoTeste]).size,
                lengthSemEspacos: textoTeste.replace(/\s/g, '').length,
                linhas: (textoTeste.match(/\n/g) || []).length + 1
            });
            
            // Exibir no console como diferentes sistemas poderiam contar
            return {
                "Contagem bruta (todos os caracteres)": textoTeste.length,
                "Contagem sem espaços e quebras": textoTeste.replace(/\s/g, '').length,
                "Contagem só sem quebras": textoTeste.replace(/[\r\n]/g, '').length,
                "Bytes UTF-8": new Blob([textoTeste]).size
            };
        }
        
        // Executar teste de contagem para comparação
        console.log('Comparação de métodos de contagem:', testarContagem());
            
        // Classe ResumoSentenca para resumir sentenças
        class ResumoSentenca {
            constructor() {
                // Padrões de regex para identificar seções importantes
                this.padroesImportantes = {
                    processo: [
                        /Processo\s*n[º°]?\s*([\d./\-]+)/i,
                        /Autos\s*n[º°]?\s*([\d./\-]+)/i
                    ],
                    cabeçalho: [
                        /Tribunal\s*de\s*Justiça/i,
                        /Comarca\s*de\s*[A-Za-zÀ-ÿ\s]+/i
                    ],
                    reu: [
                        /Réu:\s*([^\n]+)/i,
                        /Denunciado[:\s]*([^\n]+)/i,
                        /Acusado[:\s]*([^\n]+)/i
                    ],
                    dispositivo: [
                        /Dispositivo[:]*\s*(.+?)(?=Pena:|$)/is,
                        /Decisão[:]*\s*(.+?)(?=Pena:|$)/is,
                        /JULGO\s+(PROCEDENTE|PARCIALMENTE PROCEDENTE|IMPROCEDENTE)\s+/i
                    ],
                    pena: [
                        /Pena:\s*(.+?)(?=Regime|$)/is,
                        /Condenado\s*a\s*(.+?)(?=Regime|$)/is,
                        /(\d+)\s+(ano|anos|mês|meses|dia|dias)\s+(?:e\s+(\d+)\s+(mês|meses|dia|dias))?/i
                    ],
                    artigo: [
                        /Art(?:igo)?\.?\s*(\d+[^\n,]+)/i,
                        /Lei\s*n[º°]?\s*(\d+[^\n,]+)/i,
                        /CP,\s*art(?:igo)?\.?\s*(\d+[^\n,]+)/i
                    ],
                    datas: [
                        /Data\s*d[aeo]\s*([^:]+):\s*([\d\/]+)/gi
                    ]
                };
            }

            // Método para extrair seções específicas
            extrairSecao(texto, secao) {
                const padroes = this.padroesImportantes[secao];
                
                for (const padrao of padroes) {
                    const match = texto.match(padrao);
                    if (match) {
                        // Retorna o primeiro grupo de captura ou toda a correspondência
                        return match[1] || match[0];
                    }
                }
                
                return null;
            }

            // Método principal para resumir sentença
            resumir(texto) {
                if (!texto || texto.trim() === '') {
                    return '';
                }
                
                let resumo = '';
                
                // Extrair processo
                const processo = this.extrairSecao(texto, 'processo');
                if (processo) resumo += `Processo: ${processo}\n\n`;
                
                // Extrair cabeçalho
                const cabeçalho = this.extrairSecao(texto, 'cabeçalho');
                if (cabeçalho) resumo += `${cabeçalho}\n\n`;
                
                // Extrair réu
                const reu = this.extrairSecao(texto, 'reu');
                if (reu) resumo += `Réu: ${reu}\n\n`;
                
                // Extrair artigos
                const artigos = this.extrairSecao(texto, 'artigo');
                if (artigos) resumo += `Artigos: ${artigos}\n\n`;
                
                // Extrair dispositivo
                const dispositivo = this.extrairSecao(texto, 'dispositivo');
                if (dispositivo) resumo += `Dispositivo: ${dispositivo}\n\n`;
                
                // Extrair pena
                const pena = this.extrairSecao(texto, 'pena');
                if (pena) resumo += `Pena: ${pena}\n\n`;
                
                // Extrair datas importantes
                const datasMatch = [...texto.matchAll(this.padroesImportantes.datas)];
                if (datasMatch && datasMatch.length > 0) {
                    for (const match of datasMatch) {
                        if (match[1] && match[2]) {
                            resumo += `Data ${match[1].trim()}: ${match[2].trim()}\n`;
                        }
                    }
                }
                
                return resumo.trim();
            }

                // Método para validar se o resumo é válido
                validarResumo(resumo) {
                    if (!resumo || resumo.trim() === '') {
                        return false;
                    }
                    
                    // Critérios mínimos para um resumo válido
                    const criterios = [
                        resumo.includes('Processo'),
                        resumo.includes('Réu'),
                        resumo.includes('Artigos'),
                        resumo.includes('Dispositivo'),
                        resumo.includes('Pena'),
                        resumo.includes('Data')
                    ];
                    
                    return criterios.filter(Boolean).length >= 3;
                }
            }

            // Classe PreencherGuia para preencher o formulário automaticamente
            class PreencherGuia {
                constructor() {
                    // Mapeamento de campos do resumo para IDs do formulário
                    this.camposMapeados = {
                        'Processo': 'numeroProcesso',
                        'Réu': 'nomeReu',
                        'Artigos': 'artigo',
                        'Pena': 'tempoPena',
                        'Dispositivo': 'decisao'
                    };

                    // Mapeamento para campos específicos de data
                    this.mapeamentoCampos = {
                        'dataInfracao': [
                            /data\s*(?:da)?\s*(?:infração|delito|crime)/i,
                            /ocorrência\s*(?:do)?\s*crime/i
                        ],
                        'dataRecebimentoDenuncia': [
                            /recebimento\s*(?:da)?\s*den[úu]ncia/i,
                            /data\s*da\s*den[úu]ncia/i
                        ],
                        'dataPublicacaoSentenca': [
                            /data\s*(?:da|de)?\s*publica[çc][aã]o\s*(?:da)?\s*senten[çc]a/i,
                            /senten[çc]a\s*publicada\s*em/i
                        ],
                        'dataPublicacaoAcordao': [
                            /data\s*(?:da|de)?\s*publica[çc][aã]o\s*(?:do)?\s*ac[óo]rd[ãa]o/i,
                            /ac[óo]rd[ãa]o\s*publicado\s*em/i
                        ],
                        'dataTransitoDefesa': [
                            /data\s*(?:do)?\s*tr[âa]nsito\s*(?:em\s*julgado)?\s*(?:para\s*)?(?:a)?\s*defesa/i,
                            /tr[âa]nsito\s*em\s*julgado\s*(?:para\s*)?(?:a)?\s*defesa/i
                        ],
                        'dataTransitoAcusacao': [
                            /data\s*(?:do|de)?\s*tr[âa]nsito\s*(?:em\s*julgado)?\s*(?:para\s*)?(?:a)?\s*acusa[çc][ãa]o/i,
                            /tr[âa]nsito\s*em\s*julgado\s*(?:para\s*)?(?:a)?\s*acusa[çc][ãa]o/i
                        ],
                        'dataTransitoReu': [
                            /data\s*(?:do|de)?\s*tr[âa]nsito\s*(?:em\s*julgado)?\s*(?:para\s*)?(?:o)?\s*r[ée]u/i,
                            /tr[âa]nsito\s*em\s*julgado\s*(?:para\s*)?(?:o)?\s*r[ée]u/i
                        ],
                        'lei': [
                            /(?:Lei|Código)\s*(?:Penal)?/i
                        ]
                    };

                    // Padrões para detecção de regime prisional
                    this.regimesPrisionais = {
                        'fechado': ['regime fechado', 'prisão em regime fechado'],
                        'semiaberto': ['regime semiaberto', 'prisão em regime semiaberto'],
                        'aberto': ['regime aberto', 'prisão em regime aberto']
                    };

                    // Padrões para checkbox
                    this.checkboxPatterns = {
                        'crimeTentado': ['crime tentado', 'tentativa de crime'],
                        'violenciaDomestica': ['violência doméstica', 'lei maria da penha'],
                        'resultadoMorte': ['resultado morte', 'seguido de morte'],
                        'violenciaGraveAmeaca': ['violência grave ameaça', 'grave ameaça'],
                        'reincidenteComum': ['reincidente comum', 'reincidência'],
                        'reincidenteEspecifico': ['reincidente específico'],
                        'comandoOrganizacao': ['comando organização criminosa', 'organização criminosa']
                    };
                }

                // Método principal para processar resumo e preencher formulário
                processarResumo(textoResumo) {
                    if (!textoResumo || textoResumo.trim() === '') {
                        alert('O texto do resumo está vazio.');
                        return;
                    }
                    
                    // Validar o resumo
                    let resumoValidado = textoResumo;
                    
                    // Usar o resumidor se necessário
                    const resumidor = new ResumoSentenca();
                    if (!resumidor.validarResumo(textoResumo)) {
                        resumoValidado = resumidor.resumir(textoResumo);
                    }

                    // Campos a serem preenchidos
                    const camposPreenchidos = [];

                    // Preencher campos mapeados
                    Object.entries(this.camposMapeados).forEach(([padrao, campoId]) => {
                        const campo = document.getElementById(campoId);
                        if (campo) {
                            const regex = new RegExp(`${padrao}:\\s*(.+)`, 'i');
                            const match = resumoValidado.match(regex);
                            
                            if (match) {
                                campo.value = match[1].trim();
                                camposPreenchidos.push(campo);
                            }
                        }
                    });

                    // Preencher campos por padrões flexíveis
                    Object.entries(this.mapeamentoCampos).forEach(([campoId, padroes]) => {
                        const campo = document.getElementById(campoId);
                        if (campo) {
                            padroes.some(padrao => {
                                const regex = new RegExp(`${padrao}[:\\s]*([\\d/]+)`, 'i');
                                const match = resumoValidado.match(regex);
                                
                                if (match) {
                                    campo.value = match[1].trim();
                                    camposPreenchidos.push(campo);
                                    return true;
                                }
                                return false;
                            });
                        }
                    });

                    // Preencher tempo de pena (anos, meses, dias)
                    const penaPadrao = /(\d+)\s+anos?(?:\s*,?\s*e?\s*(\d+)\s+meses?)?(?:\s*,?\s*e?\s*(\d+)\s+dias?)?/i;
                    const penaPadrao2 = /(\d+)\s+meses?(?:\s*,?\s*e?\s*(\d+)\s+dias?)?/i;
                    const penaPadrao3 = /(\d+)\s+dias?/i;
                    
                    const penaMatch = resumoValidado.match(penaPadrao);
                    const penaMatch2 = resumoValidado.match(penaPadrao2);
                    const penaMatch3 = resumoValidado.match(penaPadrao3);
                    
                    if (penaMatch) {
                        const anosInput = document.getElementById('anos');
                        const mesesInput = document.getElementById('meses');
                        const diasInput = document.getElementById('dias');
                        
                        if (anosInput && penaMatch[1]) {
                            anosInput.value = penaMatch[1];
                            camposPreenchidos.push(anosInput);
                        }
                        
                        if (mesesInput && penaMatch[2]) {
                            mesesInput.value = penaMatch[2];
                            camposPreenchidos.push(mesesInput);
                        }
                        
                        if (diasInput && penaMatch[3]) {
                            diasInput.value = penaMatch[3];
                            camposPreenchidos.push(diasInput);
                        }
                    } else if (penaMatch2) {
                        const mesesInput = document.getElementById('meses');
                        const diasInput = document.getElementById('dias');
                        
                        if (mesesInput && penaMatch2[1]) {
                            mesesInput.value = penaMatch2[1];
                            camposPreenchidos.push(mesesInput);
                        }
                        
                        if (diasInput && penaMatch2[2]) {
                            diasInput.value = penaMatch2[2];
                            camposPreenchidos.push(diasInput);
                        }
                    } else if (penaMatch3) {
                        const diasInput = document.getElementById('dias');
                        
                        if (diasInput && penaMatch3[1]) {
                            diasInput.value = penaMatch3[1];
                            camposPreenchidos.push(diasInput);
                        }
                    }

                    // Preencher checkboxes
                    Object.entries(this.checkboxPatterns).forEach(([checkboxId, padroes]) => {
                        const checkbox = document.getElementById(checkboxId);
                        if (checkbox) {
                            const encontrado = padroes.some(padrao => 
                                resumoValidado.toLowerCase().includes(padrao.toLowerCase())
                            );
                            
                            if (encontrado) {
                                checkbox.checked = true;
                                camposPreenchidos.push(checkbox);
                            }
                        }
                    });

                    // Detectar regime prisional
                    const campoRegime = document.getElementById('regimePrisional');
                    if (campoRegime) {
                        Object.entries(this.regimesPrisionais).some(([valor, padroes]) => {
                            const encontrado = padroes.some(padrao => 
                                resumoValidado.toLowerCase().includes(padrao.toLowerCase())
                            );
                            
                            if (encontrado) {
                                campoRegime.value = valor;
                                camposPreenchidos.push(campoRegime);
                                return true;
                            }
                            return false;
                        });
                    }

                    // Destacar campos preenchidos
                    this.destacarCamposPreenchidos(camposPreenchidos);

                    // Notificação de preenchimento
                    this.notificarPreenchimento(camposPreenchidos.length);
                }

                // Método para destacar campos preenchidos
                destacarCamposPreenchidos(campos) {
                    campos.forEach(campo => {
                        campo.classList.add('campo-preenchido-auto');
                        
                        // Evento para remover destaque quando editado
                        const removeDestaque = () => campo.classList.remove('campo-preenchido-auto');
                        
                        if (campo.type === 'checkbox') {
                            campo.addEventListener('change', removeDestaque, {once: true});
                        } else {
                            campo.addEventListener('input', removeDestaque, {once: true});
                        }
                    });
                }

                // Método para notificar preenchimento
                notificarPreenchimento(quantidadeCampos) {
                    // Remover toast existente, se houver
                    const toastExistente = document.getElementById('toast-notificacao');
                    if (toastExistente) {
                        document.body.removeChild(toastExistente);
                    }

                    const toast = document.createElement('div');
                    toast.id = 'toast-notificacao';
                    toast.style.position = 'fixed';
                    toast.style.bottom = '20px';
                    toast.style.right = '20px';
                    toast.style.backgroundColor = '#4CAF50';
                    toast.style.color = 'white';
                    toast.style.padding = '15px';
                    toast.style.borderRadius = '5px';
                    toast.style.zIndex = '1000';
                    toast.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
                    toast.textContent = `Preenchimento automático concluído. ${quantidadeCampos} campos atualizados.`;
                    
                    document.body.appendChild(toast);
                    
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 3000);
                }
            }

            // Função para concatenar campos
            document.getElementById('concatenarCampos').addEventListener('click', () => {
                const denuncia = document.getElementById('denuncia').innerText;
                const sentenca = document.getElementById('sentenca').innerText;
                const acordao = document.getElementById('acordao').innerText;
                const transitoJulgado = document.getElementById('transitoJulgado').innerText;
                
                let resumoConcatenado = '';
                
                if (denuncia.trim()) {
                    resumoConcatenado += `Denúncia: ${denuncia.trim()}\n\n`;
                }
                
                if (sentenca.trim()) {
                    resumoConcatenado += `Sentença: ${sentenca.trim()}\n\n`;
                }
                
                if (acordao.trim()) {
                    resumoConcatenado += `Acórdão: ${acordao.trim()}\n\n`;
                }
                
                if (transitoJulgado.trim()) {
                    resumoConcatenado += `Trânsito em Julgado: ${transitoJulgado.trim()}\n\n`;
                }
                
                const resumoElement = document.getElementById('resumo');
                resumoElement.innerText = resumoConcatenado.trim();
                
                // Atualizar contagem de caracteres
                contarCaracteres(resumoElement, 'resumoCount');
            });
            
            // Botão para limpar campos
            document.getElementById('limparCampos').addEventListener('click', () => {
                const confirmacao = confirm('Tem certeza que deseja limpar todos os campos?');
                if (confirmacao) {
                    camposEditaveis.forEach(({ campo }) => {
                        document.getElementById(campo).innerText = '';
                        contarCaracteres(document.getElementById(campo), campo + 'Count');
                    });
                }
            });
            
            // Botão para salvar resumo
            document.getElementById('salvarResumo').addEventListener('click', () => {
                const resumo = document.getElementById('resumo').innerText;
                if (!resumo.trim()) {
                    alert('O resumo está vazio. Não há nada para salvar.');
                    return;
                }
                
                // Salvar em localStorage
                localStorage.setItem('resumoSalvo', resumo);
                alert('Resumo salvo com sucesso!');
            });

            // Botão Resumir Sentença
            document.getElementById('resumirSentenca').addEventListener('click', () => {
                const sentencaField = document.getElementById('sentenca');
                const textoOriginal = sentencaField.innerText;
                
                if (!textoOriginal.trim()) {
                    alert('O campo de sentença está vazio. Não há nada para resumir.');
                    return;
                }
                
                // Resumir sentença
                const resumidor = new ResumoSentenca();
                const resumo = resumidor.resumir(textoOriginal);
                
                // Atualizar campo de resumo
                const resumoField = document.getElementById('resumo');
                resumoField.innerText = resumo;
                
                // Atualizar contagem de caracteres
                contarCaracteres(resumoField, 'resumoCount');
            });

            // Botões de inserção de exemplos (para testes)
            const insercoes = {
                'inserirDenuncia': 'Réu: João da Silva\nData da infração: 15/01/2025\nArtigo 157 do Código Penal\nDescrição: Acusado de roubo qualificado com uso de arma de fogo.',
                'inserirSentenca': 'Processo nº 0001234-56.2025.8.17.0001\nTribunal de Justiça de Pernambuco\nData da publicação da sentença: 20/02/2025\nDispositivo: Condenação por roubo qualificado\nPena: 8 anos e 6 meses de reclusão em regime fechado.',
                'inserirAcordao': 'Apelação Criminal nº 2025.123456-7\nÓrgão Julgador: 1ª Câmara Criminal\nData de publicação do acórdão: 10/03/2025\nDecisão: Negado provimento ao recurso, mantida a condenação.',
                'inserirTransito': 'Data do trânsito em julgado para defesa: 25/03/2025\nData do trânsito em julgado para acusação: 20/03/2025\nData do trânsito em julgado do réu: 25/03/2025'
            };
            
            Object.entries(insercoes).forEach(([botaoId, texto]) => {
                const botao = document.getElementById(botaoId);
                if (botao) {
                    botao.addEventListener('click', () => {
                        const alvo = botaoId.replace('inserir', '').toLowerCase();
                        const elemento = document.getElementById(alvo);
                        if (elemento) {
                            elemento.innerText = texto;
                            contarCaracteres(elemento, alvo + 'Count');
                        }
                    });
                }
            });
            
            // Inicializar preenchedor de guia e adicionar evento ao botão
            const preenchedor = new PreencherGuia();
            const botaoPreenchimento = document.getElementById('preencherAutomatico');
            if (botaoPreenchimento) {
                botaoPreenchimento.addEventListener('click', () => {
                    const resumoField = document.getElementById('resumo');
                    const resumoTexto = resumoField.innerText;

                    if (!resumoTexto.trim()) {
                        alert('O campo de resumo está vazio. Preencha o resumo primeiro.');
                        return;
                    }

                    preenchedor.processarResumo(resumoTexto);
                });
            }
            
            // Funcionalidade para os botões de limpar campos
            document.querySelectorAll('.clear-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const input = e.target.closest('.input-with-clear').querySelector('input');
                    if (input) {
                        input.value = '';
                        input.focus();
                    }
                });
            });
            
            // Botão adicionar parágrafo
            document.getElementById('adicionarParagrafo').addEventListener('click', () => {
                alert('Funcionalidade para adicionar novo parágrafo de tipificação a ser implementada.');
                // Aqui você pode implementar a lógica para adicionar um novo parágrafo de tipificação
            });
            
            // Eventos para botões de formulário
            document.getElementById('cancelarForm').addEventListener('click', () => {
                if (confirm('Tem certeza que deseja cancelar? Todas as alterações serão perdidas.')) {
                    window.location.reload();
                }
            });
            
            document.getElementById('salvarRascunho').addEventListener('click', () => {
                alert('Rascunho salvo com sucesso!');
                // Aqui poderia implementar o salvamento real
            });
            
            document.getElementById('guiaRecolhimentoForm').addEventListener('submit', (e) => {
                e.preventDefault();
                alert('Formulário enviado com sucesso!');
                // Aqui poderia implementar o envio real do formulário
            });
        });
    </script>
</body>
</html>
